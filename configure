#!/bin/sh
set -eu # to debug this script add '-x'

###############################################################################
# Prelude
###############################################################################
# The goal of this script is to automate the configuration and installation
# of packages that are needed to then compile and install efuns itself.
# See also my https://github.com/aryx/xix/blob/master/configure for more info.

###############################################################################
# Platform specific setup
###############################################################################

###############################################################################
# Platform independent
###############################################################################

#TODO:
# - enable or disable tree-sitter based parsers and pfff stuff
#   and detect OS for appropriate settings
# - enable cairo or not. See my old Makefile.config with
#   USE_PFFF=1
#   USE_GTKCAIRO2=1
#   as I can also compile for just the graphics.cma library

#TODO:
# - check opam is in PATH
# - check opam was initialized
# - use opam.locked

#in theory we should also
# - check the ocaml switch is a good version
# - check external deps are installed (e.g., pcre, semgrep! codemap!)

opam install --no-depexts --deps-only ./efuns.opam -y

echo 'Everything looks fine. You can now run: '
echo
echo '   $ make'
echo '   $ make all'
echo '   $ make install'
